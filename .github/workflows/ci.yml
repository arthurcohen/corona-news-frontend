name: CI

on:
  push:
    branches: 
        - master
        - dev
        - gcp

jobs:
  build:
    name: Build

    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [10.x]

    steps:
    - uses: actions/checkout@v2
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v1
      with:
        node-version: ${{ matrix.node-version }}

    - name: Install Dependencies
      run: npm ci

    - name: Build
      run: npm run build
        
    # - name: Deploy to Firebase Staging
    #   if: github.ref == 'refs/heads/dev'
    #   uses: w9jds/firebase-action@master
    #   with:
    #     args: "deploy --only hosting:staging"
    #   env:
    #     FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
    #     PROJECT_ID: 'goodnews-2c75a'

    # - name: Deploy to Firebase Prod
    #   if: github.ref == 'refs/heads/master'
    #   uses: w9jds/firebase-action@master
    #   with:
    #     args: "deploy --only hosting:prod"
    #   env:
    #     FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
    #     PROJECT_ID: 'goodnews-2c75a'
        
    - name: Deploy Staging
      if: github.ref == 'refs/heads/gcp'
      uses: actions-hub/gcloud@master
      env:
        PROJECT_ID: thegoodnewscoronavirus
        APPLICATION_CREDENTIALS: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAidGhlZ29vZG5ld3Njb3JvbmF2aXJ1cyIsCiAgInByaXZhdGVfa2V5X2lkIjogIjI2YmFjMjJlYjQwY2NlYjRmYjVjNjJhZDZkMWE2MDgwOGE5MGQ1NDciLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2QUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktZd2dnU2lBZ0VBQW9JQkFRQ3Iyc1BKZmFKc0FMYzVcbmxYUzBGM2FxNDhDcTlUWkZGanhIc1o5aWtEWk1URkducFl0akY0QnNFYWYrZCttVThXZUxDOWlTZjlpL1k4SjlcbjJmY3Bid0lraGlwZjNXblY4V1h5bnJ1azlMRVVUaWhjL1Y0S3BQdTdQdUMyNmphcEE1Z1paNVVEMEZVK1ZJZjZcbkpjLzh0SkplT055aDhUUDk0Z0xFcEtrdFpNUTN2STZKeGVaVU5neVJ4VHZDaUNRb1ZQQkppTnpGVmJGUlBSekZcbjlWY1RnMnBvNlBVYWNkQ1p2VFVnR2srdnlWVnpJM3A1RkNpL1pOOG8yVEhaZERrL2k4S3J1U1VYdXcrM04zeWVcbkRLdDl3UFJNWHQzWHY3Wmx2bU5oYWNsNkNJZmZCNVpXaEUrSCtDdk8vaDNPeVlZU1lKUmJRVU4ycDQzYXBNRWlcbnMrWlJaVW9MQWdNQkFBRUNnZ0VBSkUvSGtiSHRtVU4zYzMvY1ZsY2syRXZpUUYwcWwrTndYamV1TlQzQ2MxR21cbjZUVGw1RXlwY213eW9tYUU0TmMzS1I2YUpxNUR4b0RXTGhCWmxKUWprRU1XL2dXRElOVHVWUnJzREJrMXQxUWlcblhDK2U2TUhlZkx4Mjc3OUNTR2o5Z05TdG5FNHZUTW5BcDM3STJSendWbDlPWXh0YmdIZjZYTUZzQzY3Z2RPUVdcbk91NXVPaUxlT0lPUGVrMXhUYzhXMkxBNFYyUjFsaFh4cmJtV2VOTVVFREdyY2FCbGlEYmE4Z0Z5eVRraitqczBcbjd5bExBbXdld2YwVUdqUzZ1ZFZkT3hYZHpsR0xJNWhtaW9wSER6MklTM2JrMFliVWpvN0Jka2pPc3FEbkxGdC9cbnhGVXNJSmVVS2FIQ05zcEJBVE53M2RRZ3Q2UWJmL3RxcjREU29FbzRjUUtCZ1FEY3doTDA5dG5TWTNtYkk3V1BcblJQb01HTDJjTEh2SEVtc2RFbzhlV0E2SGxYM1BaL1JHdmY0TzhTd1JFdU9HZXVyQmo1aVZFbVFxYk9uL0RHRERcbi9kU1RJMU1oUmtZV0VtK2RTckZBRndHTHNKblIzbTJNajdzNFM4YzVHcTBNdVVnaXdTNk8rbUQrVTI2TXVkYXNcbkxkMU5ubzNpQTd4YmN0VVhIVHJzTkgxNDBRS0JnUURIU2hxZGtob29ORTdKODJsb0ZIb3JMUWZWZjlCc0cyMGNcbklYd3Bnbjgya1QxY2hrTlIyWVZrZk1YQy91cm9QbXhDNGphTldXYllCaUtsZGtYaUFYKzk0QWFIOWVOMnpIaklcbk5XYnh3K1NvMHMxamNuSVVjSEtnYVg4cFdGbFAvbWQxdXgrclBlaEkrbkxMWHVnbW9pVW9RL0Z3NDlBN0doN25cbjdVZzBwblBNR3dLQmdEcjZhcUFobHg0N1QxRGdZSEJQYUZKMUJhdEV3eWp6UmNTMW9hRGt1N1VEZm1JOERxb2JcbnRsVjluMTFNWTVjWkhjRHF3VVFLYnRKYTJNVTRKRjRZWVlPUjYzSzNXS0FxK3NEV0pMYlBycTBJV0lBV1ljUXNcbjNrTHpFOTJ3djh6bmIxdEJxMU90bHQ0N29neGMxZnFZSWtqTGRIS090dkxqb2dTVDNac2ZodW9SQW9HQUZxUnVcbnZiUlowSE9RK0JUMXh1Tjh0ZWNaMnNINDFpK1BpQUN0OExGbzdyUTF1b3R1bnFBT0xjcVhWWDVOQmpJQmJ0L3dcbnZzS0hrc2V2ckFqeUM2bUw3L0RDRFRSOHNZU3R2R0dFM3JjWkJhMWR0SXpPTlZCSlZieG12RFhUZitreHJBaWtcbm9ub1lLQ0o4WkdyV0NYMm1weHFCRmdoc0lpcm5sQVk3aSsvVmZEMENnWUJpaytRaE5SSjNUYlhIb0NhMXh3SThcbkkxRmpPcnEwTjBzdTU2Z3ZpblJQTitCYnhWOWRab1dsc3RNUHROQ1NiWTFFTXdYclBubk5aQ253NnZDUzdyT0hcbkI4Slh6WTBhUENrYWFsUm5MMWlZdEQzTWwvUUJRNStPRFphWUh3cFNZcHJsTjFJVW0wQVU0ZUtrbmI5VHhXMllcbmw5RFNFOGE2U0J0eUVGK1BHMGU2MWc9PVxuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogImRlcGxveUB0aGVnb29kbmV3c2Nvcm9uYXZpcnVzLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjEwNzE2NTI0ODA2MTM1MTQ0MDcwOSIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvZGVwbG95JTQwdGhlZ29vZG5ld3Njb3JvbmF2aXJ1cy5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIKfQo=
      with:
        args: app deploy app.staging.yaml